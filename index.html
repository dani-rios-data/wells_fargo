<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wells Fargo Target Audience Analysis</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --wells-red: #D71E28;
      --wells-yellow: #FDC82F;
      --wells-dark-red: #B01A1F;
      --wells-gray: #F3F3F3;
      --wells-dark-gray: #333333;
      --wells-blue: #0077B6;
      --wells-green: #00A86B;
      --wells-purple: #8A2BE2;
      --wells-light-blue: #E1F5FE;
      --wells-light-red: #FFEBEE;
      --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      --transition-speed: 0.3s;
      
      /* Card styles */
      --wf-red: #c01923;
      --wf-red-light: #fdf5f5;
      --wf-green: #0a7e40;
      --wf-green-light: #f5fbf7;
      --wf-yellow: #b08c11;
      --wf-yellow-light: #fcfaf5;
      --wf-blue: #0063a3;
      --wf-blue-light: #f5f9fc;
      --wf-burgundy: #ae0f1e;
      --wf-burgundy-light: #fcf5f6;
      --wf-neutral-dark: #333333;
      --wf-neutral: #666666;
      --wf-neutral-light: #e6e6e6;
      --wf-panel-bg: #ffffff;
      --wf-bg: #f8f8f8;
      --card-radius: 12px;
    }
    
    body {
      font-family: 'Segoe UI', 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #F8F9FA;
      color: var(--wells-dark-gray);
      line-height: 1.6;
    }
    
    .header {
      background-color: var(--wells-red);
      color: white;
      padding: 0.7rem 1rem;
      border-bottom: 3px solid var(--wells-yellow);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-logo {
      font-weight: bold;
      font-size: 1.5rem;
      color: white;
      text-align: left;
    }
    
    .header-subtitle {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .section {
      margin-top: 2rem;
      margin-bottom: 3rem;
      background-color: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: var(--card-shadow);
      transition: all var(--transition-speed);
    }
    
    .section:hover {
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
      transform: translateY(-5px);
    }
    
    h1, h2, h3 {
      margin-top: 0;
      font-weight: 600;
      color: var(--wells-dark-gray);
    }
    
    h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: var(--wells-dark-red);
      border-bottom: 2px solid var(--wells-light-red);
      padding-bottom: 1rem;
    }
    
    h3 {
      font-size: 1.5rem;
      margin-top: 2rem;
      margin-bottom: 1.2rem;
      color: var(--wf-neutral-dark);
    }
    
    .chart-container {
      position: relative;
      margin: 15px auto;
      height: 35vh;
      width: 100%;
      border-radius: 8px;
      background-color: #FFFFFF;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .chart-container.ranking {
      height: 60vh;
      margin-top: 8px;
      margin-bottom: 30px;
      padding-left: 0;
      padding-right: 15px;
    }
    
    .filter-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      background-color: var(--wells-light-blue);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .filter-container label {
      font-weight: 600;
      color: var(--wells-blue);
      margin-right: 8px;
    }
    
    .filter-container select {
      padding: 8px 15px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      background-color: white;
    }
    
    .filter-container button {
      background-color: var(--wells-red);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }
    
    .filter-container button:hover {
      background-color: var(--wells-dark-red);
    }
    
    .text-muted {
      color: #6c757d;
      font-size: 0.98rem;
    }
    
    .info-box {
      background-color: var(--wells-light-blue);
      border-left: 4px solid var(--wells-blue);
      padding: 1.5rem;
      margin: 25px 0;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .info-box p {
      margin: 0;
    }
    
    .info-box strong {
      color: var(--wells-blue);
    }
    
    /* Nuevo estilo para las tarjetas métricas */
    .summary-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 30px 0;
    }
    
    .card {
      background-color: var(--wf-panel-bg);
      border-radius: var(--card-radius);
      box-shadow: var(--card-shadow);
      padding: 16px;
      flex: 1;
      min-width: 180px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    
    .card-header {
      border-top-left-radius: var(--card-radius);
      border-top-right-radius: var(--card-radius);
      margin: -16px -16px 15px -16px;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card.total-spend .card-header {
      background-color: var(--wf-red);
      color: white;
    }
    
    .card.consumer-financial .card-header {
      background-color: var(--wf-green);
      color: white;
    }
    
    .card.business-segments .card-header {
      background-color: var(--wf-yellow);
      color: white;
    }
    
    .card.demographic-segments .card-header {
      background-color: var(--wf-blue);
      color: white;
    }
    
    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin: 0;
      color: white;
    }
    
    .card-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background-color: rgba(255,255,255,0.3);
      color: white;
      font-size: 12px;
    }
    
    .metric-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 8px 0 0 0;
      color: var(--wf-neutral-dark);
      display: flex;
      align-items: baseline;
    }
    
    .card.total-spend .metric-value {
      color: var(--wf-red);
    }
    
    .card.consumer-financial .metric-value {
      color: var(--wf-green);
    }
    
    .card.business-segments .metric-value {
      color: var(--wf-yellow);
    }
    
    .card.demographic-segments .metric-value {
      color: var(--wf-blue);
    }
    
    .metric-decimal {
      font-size: 1.4rem;
      font-weight: 600;
      padding-left: 2px;
    }
    
    .metric-context {
      font-size: 0.8rem;
      color: var(--wf-neutral);
      margin-top: 5px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .chart-container {
        height: 45vh;
      }
      
      .chart-container.ranking {
        height: 80vh;
      }
      
      .summary-stats {
        flex-direction: column;
      }
      
      .card {
        width: 100%;
      }
      
      .section {
        padding: 1.2rem;
      }
      
      .filter-container {
        width: 100%;
        margin-bottom: 15px;
      }
    }
    
    @media (min-width: 769px) {
      .filter-container {
        min-width: 320px;
        padding: 12px 15px;
      }
    }
    
    .loading-indicator {
      text-align: center;
      padding: 50px;
      font-size: 18px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      margin: 20px auto;
      border: 4px solid rgba(215, 30, 40, 0.2);
      border-top: 4px solid #D71E28;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .filter-year-container {
      background-color: var(--wells-light-blue);
      padding: 12px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      min-width: 200px;
      display: flex;
      align-items: center;
    }
    
    .filter-year-container select {
      min-width: 120px;
    }
    
    /* Custom tooltip styles */
    .custom-tooltip {
      background: #fff;
      padding: 10px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 280px;
    }
    
    .tooltip-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
      font-size: 13px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    
    .tooltip-row {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      font-size: 11px;
    }
    
    .color-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .category-name {
      flex: 1;
      color: #555;
      margin-right: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .tooltip-value {
      font-weight: 600;
      color: var(--wells-red);
      margin-right: 3px;
    }
    
    .tooltip-percentage {
      color: #777;
      font-size: 10px;
    }
    
    .ranking-header {
      position: relative;
      padding-bottom: 5px;
      margin-top: 50px;
    }
    
    .ranking-header h3 {
      font-size: 2rem;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
      padding-top: 1.5rem;
      padding-bottom: 1rem;
      color: var(--wells-dark-red);
      text-align: center;
    }
    
    .title-container {
      max-width: 60%;
    }
    
    @media (max-width: 768px) {
      .title-container {
        max-width: 100%;
      }
    }
    
    .year-filter-container {
      margin-bottom: 5px;
    }
    
    .mt-5 {
      margin-top: 4rem !important;
    }
    
    .pt-5 {
      padding-top: 3.5rem !important;
    }
    
    .chart-title {
      font-size: 16px;
      color: var(--wells-dark-gray);
      text-align: center;
      margin-bottom: 15px;
      font-weight: 600;
    }
    
    .donut-container {
      height: 60vh;
      padding: 1rem;
      padding-left: 15px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    @media (max-width: 992px) {
      .chart-container.ranking,
      .donut-container {
        height: 60vh;
        padding-left: 0;
        margin-bottom: 20px;
      }
    }
    
    .row.g-4 {
      margin: 0;
      align-items: center;
    }
    
    .chart-container.line-chart {
      height: 45vh;
      margin-top: 30px;
      padding-top: 30px;
    }
    
    .ranking-header-style {
      font-size: 2rem;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
      padding-top: 1.5rem;
      padding-bottom: 1rem;
      color: var(--wells-dark-red);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="container">
      <div class="d-flex align-items-center">
        <h1 class="header-logo mb-0">WELLS FARGO</h1>
        <span class="header-subtitle ms-3">Ad Spend Analysis Dashboard</span>
      </div>
    </div>
  </div>
  
  <div class="container">
    <!-- Indicador de carga -->
    <div id="loading-indicator" class="loading-indicator">
      <div class="spinner"></div>
      <p>Loading data, please wait...</p>
    </div>

    <!-- Selector de archivo manual -->
    <div id="manual-upload" style="display: none; text-align: center; padding: 30px; background-color: #f8f8f8; border-radius: 8px; margin-bottom: 20px;">
      <h3>Carga manual de datos</h3>
      <p>El archivo wells_fargo_Monthly_Spend_by_Macro.csv no se pudo cargar automáticamente. Por favor, selecciona el archivo manualmente:</p>
      <input type="file" id="csv-file-input" accept=".csv" class="form-control" style="max-width: 400px; margin: 0 auto 15px auto;">
      <button id="load-csv-button" class="btn btn-primary">Cargar CSV</button>
    </div>

    <!-- Target Audience Analysis Section -->
    <div class="section">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
        <div>
          <h2>Target Audience Analysis</h2>
          <p class="text-muted">Data based on audience targeting parameters from advertising campaigns</p>
        </div>
      </div>
      
      <div class="info-box">
        <p><strong>About this analysis:</strong> This dashboard shows how advertising focus has shifted across different audience segments over time. 
        Data is categorized based on key consumer and business owner segments identified in campaign targeting.</p>
      </div>
      
      <div class="summary-stats" id="audience-summary-container">
        <!-- Audience stats cards will be populated here -->
      </div>
      
      <!-- Main time series chart -->
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2">
        <h3 class="mt-4 ranking-header-style mb-0">Ad Spend Trends by Audience Category</h3>
        <div class="filter-year-container ms-md-3 mt-3 mt-md-0">
          <label for="yearOverallFilter" class="me-2">Year:</label>
          <select id="yearOverallFilter" class="form-select">
            <option value="all">All Years</option>
            <!-- Will be populated dynamically -->
          </select>
        </div>
      </div>
      <div class="chart-container line-chart">
        <div id="audienceChart"></div>
      </div>
      
      <!-- Ranking chart with filter -->
      <div class="mt-5 pt-3">
        <div class="ranking-header">
          <h3 class="mb-4">Total Spend Ranking by Audience Category</h3>
          
          <!-- Filter container - simplified -->
          <div class="year-filter-container">
            <div class="d-flex align-items-center">
              <label for="yearFilter" class="me-3 fw-bold">Filter by Year:</label>
              <select id="yearFilter" class="form-select" style="max-width: 200px;">
                <option value="all">All Years</option>
                <!-- Years will be populated dynamically -->
              </select>
            </div>
          </div>
        </div>
        
        <div class="row g-4">
          <div class="col-lg-6">
            <div class="chart-container ranking">
              <div id="categoryDistributionChart"></div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="chart-container donut-container">
              <div id="categoryDonutChart"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize variables
    let audienceChart;
    let categoryChart;
    let donutChart;
    let audienceCategories = {};
    let audienceByDate = {};
    let totalAudienceReferences = 0;
    let allData = []; // Store all data for filtering
    let years = []; // Available years for filtering
    
    // Colors for the chart (Wells Fargo style)
    const colorPalette = [
      '#c01923', // Wells Fargo red
      '#0063a3', // Blue
      '#0a7e40', // Green
      '#8A2BE2', // Purple
      '#b08c11', // Yellow
      '#FF8C00', // Orange
      '#4B0082', // Indigo
      '#2F4F4F', // Dark slate
    ];
    
    // Helper function to categorize audience targeting
    function categorizeAudience(description) {
      // If audience_category is already provided, use it directly
      if (description && (
          description.startsWith('Consumer +') || 
          description === 'Business Owner Categories' ||
          description === 'Uncategorized' ||
          description === 'Young Adults & Students' ||
          description === 'Homeowners & Real Estate' ||
          description === 'Affluent & Wealth Management' ||
          description === 'Family & Lifestyle' ||
          description === 'Digital & Tech Savvy' ||
          description === 'General Demographics' ||
          description === 'General Audience' ||
          description === 'Other Consumer Segments'
      )) {
        return description;
      }
      
      if (!description) return "Other Consumer Segments";
      
      description = description.toLowerCase();
      
      // Consumer + Financial Goals
      if (description.includes('save money') || description.includes('savings') ||
          description.includes('high-yield') || description.includes('interest rates') ||
          description.includes('credit score') || description.includes('establish credit') ||
          description.includes('banking solutions') || description.includes('budget') ||
          description.includes('investment') || description.includes('financial planning')) {
        return "Consumer + Financial Goals";
      }
      
      // Consumer + Shopping Behavior
      if (description.includes('discounts') || 
          (description.includes('savings') && description.includes('online shopping')) ||
          description.includes('coupon codes') || description.includes('promo codes') ||
          description.includes('cash back') || description.includes('rewards')) {
        return "Consumer + Shopping Behavior";
      }
      
      // Consumer + Banking Preferences
      if (description.includes('mobile devices') || description.includes('mobile app') ||
          description.includes('no fees') || description.includes('no minimums') ||
          description.includes('transparent') || description.includes('straightforward') ||
          description.includes('convenient') || description.includes('accessible')) {
        return "Consumer + Banking Preferences";
      }
      
      // Consumer + Product Types
      if (description.includes('credit card') || 
          description.includes('savings account') ||
          description.includes('auto loan') || description.includes('financing') ||
          description.includes('certificate of deposit') || description.includes(' cd ')) {
        return "Consumer + Product Types";
      }
      
      // Consumer + Specific Interests
      if (description.includes('travel rewards') ||
          description.includes('holiday shopping') ||
          description.includes('security') || description.includes('digital banking')) {
        return "Consumer + Specific Interests";
      }
      
      // Business Owner Categories
      if (description.includes('business owner') || description.includes('commercial') ||
          description.includes('flexible spending') || description.includes('data analytics') ||
          description.includes('real estate')) {
        return "Business Owner Categories";
      }
      
      // New categories
      if (description.includes('student') || description.includes('college') ||
          description.includes('young adult') || description.includes('millennial') ||
          description.includes('gen z')) {
        return "Young Adults & Students";
      }
      
      if (description.includes('homeowner') || description.includes('real estate') ||
          description.includes('property') || description.includes('mortgage') ||
          description.includes('home equity')) {
        return "Homeowners & Real Estate";
      }
      
      if (description.includes('affluent') || description.includes('wealth') ||
          description.includes('high net worth') || description.includes('premium') ||
          description.includes('luxury')) {
        return "Affluent & Wealth Management";
      }
      
      if (description.includes('family') || description.includes('lifestyle') ||
          description.includes('parent') || description.includes('child') ||
          description.includes('retirement')) {
        return "Family & Lifestyle";
      }
      
      if (description.includes('digital') || description.includes('tech') ||
          description.includes('online') || description.includes('mobile') ||
          description.includes('app')) {
        return "Digital & Tech Savvy";
      }
      
      // Fallback categories
      if (description.includes('demographic') || description.includes('segment') ||
          description.includes('market')) {
        return "General Demographics";
      }
      
      // Default fallback - changed from "Miscellaneous"
      return "Other Consumer Segments";
    }
    
    // Function to determine macro category from detailed audience category
    function getMacroCategory(category) {
      if (category.startsWith('Consumer +')) {
        return 'Consumer Segments';
      } else if (category === 'Business Owner Categories') {
        return 'Business Segments';
      } else if (
        category === 'Young Adults & Students' || 
        category === 'Homeowners & Real Estate' || 
        category === 'Affluent & Wealth Management' || 
        category === 'Family & Lifestyle' || 
        category === 'Digital & Tech Savvy'
      ) {
        return 'Demographic Segments';
      } else {
        return 'General Segments';
      }
    }
    
    // Format large numbers with abbreviations
    function formatLargeNumber(value, showDecimals = false) {
      if (value >= 1000000000) {
        return '$' + (showDecimals ? (value / 1000000000).toFixed(2) : Math.round(value / 1000000000)) + 'B';
      } else if (value >= 1000000) {
        return '$' + (showDecimals ? (value / 1000000).toFixed(2) : Math.round(value / 1000000)) + 'M';
      } else if (value >= 1000) {
        return '$' + (showDecimals ? (value / 1000).toFixed(2) : Math.round(value / 1000)) + 'K';
      }
      return '$' + (showDecimals ? value.toFixed(2) : Math.floor(value));
    }
    
    // Format currency
    function formatCurrency(value) {
      // Para mostrar en millones con dos decimales
      if (value >= 1000000) {
        const millions = value / 1000000;
        const integerPart = Math.floor(millions);
        const decimalPart = Math.round((millions - integerPart) * 100);
        return { 
          main: '$' + integerPart, 
          decimal: ',' + decimalPart.toString().padStart(2, '0') + 'M',
          full: '$' + millions.toFixed(2).replace('.', ',') + 'M',
          suffix: 'M'
        };
      }
      // Para valores en miles
      else if (value >= 1000) {
        const thousands = value / 1000;
        const integerPart = Math.floor(thousands);
        const decimalPart = Math.round((thousands - integerPart) * 100);
        return { 
          main: '$' + integerPart, 
          decimal: ',' + decimalPart.toString().padStart(2, '0') + 'K',
          full: '$' + thousands.toFixed(2).replace('.', ',') + 'K',
          suffix: 'K'
        };
      }
      
      // Para valores menores a mil
      return { 
        main: '$' + Math.floor(value), 
        decimal: ',' + Math.round((value - Math.floor(value)) * 100).toString().padStart(2, '0'),
        full: new Intl.NumberFormat('es-ES', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2
        }).format(value),
        suffix: ''
      };
    }
    
    // Load data from CSV file
    function loadCSVData() {
      console.log("Loading CSV data...");
      // Cargar datos directamente del archivo wells_fargo_Monthly_Spend_by_Macro.csv
      fetch('wells_fargo_Monthly_Spend_by_Macro.csv')
        .then(response => {
          if (!response.ok) {
            throw new Error('wells_fargo_Monthly_Spend_by_Macro.csv not found');
          }
          return response.text();
        })
        .then(csvData => {
          // Verificar si es un archivo Git LFS
          if (csvData.trim().startsWith('version https://git-lfs.github.com/spec/v1')) {
            console.log('El archivo es un puntero Git LFS, cargando datos predefinidos automáticamente');
            loadSampleData();
            return;
          }
          
          Papa.parse(csvData, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: function(results) {
              if (results.errors && results.errors.length > 0) {
                console.error('Errors parsing CSV:', results.errors);
              }
              console.log("CSV parsed successfully. Processing data...");
              processCSVData(results);
            }
          });
        })
        .catch(error => {
          console.error('Error loading CSV:', error);
          // Cargar datos predefinidos automáticamente en caso de error
          console.log('Cargando datos predefinidos automáticamente debido a un error en la carga del CSV');
          loadSampleData();
        });
    }
    
    // Función para manejar la carga manual del CSV
    function handleManualUpload() {
      const fileInput = document.getElementById('csv-file-input');
      const file = fileInput.files[0];
      
      if (!file) {
        alert('Por favor, selecciona un archivo CSV');
        return;
      }
      
      // Mostrar indicador de carga
      document.getElementById('manual-upload').style.display = 'none';
      document.getElementById('loading-indicator').style.display = 'block';
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const csvData = e.target.result;
        
        Papa.parse(csvData, {
          header: true,
          dynamicTyping: true,
          skipEmptyLines: true,
          complete: function(results) {
            if (results.errors && results.errors.length > 0) {
              console.error('Errors parsing CSV:', results.errors);
            }
            console.log("CSV uploaded manually and parsed successfully. Processing data...");
            processCSVData(results);
          }
        });
      };
      
      reader.readAsText(file);
    }
    
    // Agregar datos de ejemplo si todo falla
    function loadSampleData() {
      console.log("Cargando datos de ejemplo predefinidos...");
      
      // Datos de ejemplo basados en wells_fargo_Monthly_Spend_by_Macro.csv
      const sampleData = [
        { Date: "2024-01", audience_macro: "Business · Owner & Growth", Spend_USD: 2105836.906 },
        { Date: "2024-01", audience_macro: "Consumer · Banking Preferences", Spend_USD: 1302341.5736 },
        { Date: "2024-01", audience_macro: "Consumer · Financial Goals", Spend_USD: 2838508.3221 },
        { Date: "2024-01", audience_macro: "Consumer · Lifestyle & Interests", Spend_USD: 306528.734 },
        { Date: "2024-01", audience_macro: "Consumer · Shopping & Products", Spend_USD: 1217002.0393 },
        { Date: "2024-01", audience_macro: "Workforce & Employment", Spend_USD: 83776.3166 },
        { Date: "2024-02", audience_macro: "Business · Owner & Growth", Spend_USD: 1165907.9302 },
        { Date: "2024-02", audience_macro: "Consumer · Banking Preferences", Spend_USD: 1111192.2031 },
        { Date: "2024-02", audience_macro: "Consumer · Financial Goals", Spend_USD: 3060013.3422 },
        { Date: "2024-02", audience_macro: "Consumer · Lifestyle & Interests", Spend_USD: 640443.2169 },
        { Date: "2024-02", audience_macro: "Consumer · Shopping & Products", Spend_USD: 2039016.8411 },
        { Date: "2024-02", audience_macro: "Workforce & Employment", Spend_USD: 13673.8333 },
        { Date: "2024-03", audience_macro: "Business · Owner & Growth", Spend_USD: 1326679.0538 },
        { Date: "2024-03", audience_macro: "Consumer · Banking Preferences", Spend_USD: 1261499.8277 },
        { Date: "2024-03", audience_macro: "Consumer · Financial Goals", Spend_USD: 3916514.7749 },
        { Date: "2024-03", audience_macro: "Consumer · Lifestyle & Interests", Spend_USD: 797464.113 },
        { Date: "2024-03", audience_macro: "Consumer · Shopping & Products", Spend_USD: 3455059.9736 },
        { Date: "2024-03", audience_macro: "Workforce & Employment", Spend_USD: 21159.8672 },
        { Date: "2024-04", audience_macro: "Business · Owner & Growth", Spend_USD: 995768.3335 },
        { Date: "2024-04", audience_macro: "Consumer · Banking Preferences", Spend_USD: 1921048.8351 },
        { Date: "2024-04", audience_macro: "Consumer · Financial Goals", Spend_USD: 4408653.5986 },
        { Date: "2024-04", audience_macro: "Consumer · Lifestyle & Interests", Spend_USD: 1924576.0854 },
        { Date: "2024-04", audience_macro: "Consumer · Shopping & Products", Spend_USD: 2206129.1186 },
        { Date: "2024-04", audience_macro: "Workforce & Employment", Spend_USD: 19667.7394 },
        { Date: "2024-05", audience_macro: "Business · Owner & Growth", Spend_USD: 699272.4603 },
        { Date: "2024-05", audience_macro: "Consumer · Banking Preferences", Spend_USD: 1151441.8528 },
        { Date: "2024-05", audience_macro: "Consumer · Financial Goals", Spend_USD: 3631015.9343 },
        { Date: "2024-05", audience_macro: "Consumer · Lifestyle & Interests", Spend_USD: 1341269.1206 },
        { Date: "2024-05", audience_macro: "Consumer · Shopping & Products", Spend_USD: 1707747.4792 },
        { Date: "2024-05", audience_macro: "Workforce & Employment", Spend_USD: 25169.8607 },
        { Date: "2024-06", audience_macro: "Business · Owner & Growth", Spend_USD: 542133.3681 },
        { Date: "2024-06", audience_macro: "Consumer · Banking Preferences", Spend_USD: 560742.3104 },
        { Date: "2024-06", audience_macro: "Consumer · Financial Goals", Spend_USD: 1861537.5719 },
        { Date: "2024-06", audience_macro: "Consumer · Lifestyle & Interests", Spend_USD: 961459.0126 },
        { Date: "2024-06", audience_macro: "Consumer · Shopping & Products", Spend_USD: 1000243.3986 },
        { Date: "2024-06", audience_macro: "Workforce & Employment", Spend_USD: 13945.633 }
      ];
      
      // Procesar los datos de ejemplo
      processCSVData({ data: sampleData, errors: [] });
    }
    
    // Process CSV data
    function processCSVData(results) {
      const data = results.data;
      
      // Imprimir los encabezados para diagnóstico
      if (data && data.length > 0) {
        console.log("Encabezados del CSV:", Object.keys(data[0]));
        console.log("Muestra de los primeros datos:", data[0]);
      }
      
      // Store all filtered data for later use
      allData = data.filter(row => {
        // Verificar si las columnas existen
        if (!row["audience_macro"]) {
          console.warn("Falta audience_macro en la fila:", row);
        }
        if (!row["Date"]) {
          console.warn("Falta Date en la fila:", row);
        }
        if (!row["Spend_USD"]) {
          console.warn("Falta Spend_USD en la fila:", row);
        }
        
        return row["audience_macro"] && 
               row["Date"] && 
               row["Spend_USD"] && 
               parseFloat(row["Spend_USD"]) > 0;
      });
      
      console.log(`Total rows: ${data.length}, After filtering: ${allData.length}`);
      
      // Si no hay datos después del filtrado, intentar buscar nombres alternativos de columnas
      if (allData.length === 0 && data.length > 0) {
        console.log("Intentando con nombres alternativos de columnas...");
        
        // Obtener nombres de columnas del archivo real
        const columnas = Object.keys(data[0]);
        console.log("Columnas disponibles:", columnas);
        
        // Intentar mapear a los nombres esperados
        let columnaFecha = columnas.find(col => col.toLowerCase().includes('date') || col.toLowerCase().includes('fecha'));
        let columnaAudiencia = columnas.find(col => col.toLowerCase().includes('audience') || col.toLowerCase().includes('macro') || col.toLowerCase().includes('audiencia'));
        let columnaGasto = columnas.find(col => col.toLowerCase().includes('spend') || col.toLowerCase().includes('usd') || col.toLowerCase().includes('gasto'));
        
        console.log("Intentando con columnas alternativas:", {
          fecha: columnaFecha,
          audiencia: columnaAudiencia,
          gasto: columnaGasto
        });
        
        if (columnaFecha && columnaAudiencia && columnaGasto) {
          allData = data.filter(row => 
            row[columnaAudiencia] && 
            row[columnaFecha] && 
            row[columnaGasto] && 
            parseFloat(row[columnaGasto]) > 0
          );
          
          // Normalizar los nombres de las columnas
          allData = allData.map(row => ({
            "Date": row[columnaFecha],
            "audience_macro": row[columnaAudiencia],
            "Spend_USD": parseFloat(row[columnaGasto])
          }));
          
          console.log(`Después de mapeo: ${allData.length} filas válidas`);
        }
      }
      
      // Si aún no hay datos, mostrar error
      if (allData.length === 0) {
        document.getElementById('loading-indicator').innerHTML = 
          '<div class="alert alert-danger">Error: No se encontraron datos válidos en el archivo CSV. Verifica el formato y las columnas.</div>';
        console.error("No se encontraron datos válidos después del filtrado. Revisa el formato del CSV.");
        return;
      }
      
      // Extract available years for filtering
      years = [...new Set(allData.map(row => {
        return moment(row["Date"], "YYYY-MM").year();
      }))].sort();
      
      // Populate year filter
      const yearFilter = document.getElementById('yearFilter');
      yearFilter.innerHTML = '<option value="all">All Years</option>';
      years.forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearFilter.appendChild(option);
      });
      
      // Also populate the top year filter
      const yearOverallFilter = document.getElementById('yearOverallFilter');
      if (yearOverallFilter) {
        yearOverallFilter.innerHTML = '<option value="all">All Years</option>';
        years.forEach(year => {
          const option = document.createElement('option');
          option.value = year;
          option.textContent = year;
          yearOverallFilter.appendChild(option);
        });
        
        // Add event listener for the top year filter
        yearOverallFilter.addEventListener('change', function() {
          // Update chart year filter to match
          yearFilter.value = this.value;
          // Trigger change event on the chart filter
          updateCategoryDistributionChart();
          
          // Update audience chart
          updateAudienceChart();
        });
      }
      
      // Process all data for main charts
      processAllData();
      
      // Apply initial filter for ranking chart
      updateCategoryDistributionChart();
      
      // Set up filter event listeners
      document.getElementById('yearFilter').addEventListener('change', updateCategoryDistributionChart);
      
      // Ocultar el indicador de carga cuando los datos están listos
      document.getElementById('loading-indicator').style.display = 'none';
    }
    
    // Process all data for the main chart and summary
    function processAllData() {
      // Reset data structures
      audienceCategories = {};
      audienceByDate = {};
      totalAudienceReferences = 0;
      
      // Process all data for main chart (not filtered by year)
      allData.forEach(row => {
        const dateStr = row["Date"];
        const formattedDate = dateStr; // Ya está en formato YYYY-MM
        
        // Verificar si la fecha es válida
        if (!moment(formattedDate, 'YYYY-MM').isValid()) {
          console.warn("Fecha inválida encontrada:", dateStr);
          return; // Saltar este registro
        }

        const spend = parseFloat(row["Spend_USD"]) || 0;
        const audience = row["audience_macro"];
        
        // Track audience categories
        if (!audienceCategories[audience]) {
          audienceCategories[audience] = 0;
        }
        audienceCategories[audience] += spend;
        totalAudienceReferences += spend;
        
        // Track audience by month
        if (!audienceByDate[formattedDate]) {
          audienceByDate[formattedDate] = {};
        }
        if (!audienceByDate[formattedDate][audience]) {
          audienceByDate[formattedDate][audience] = 0;
        }
        audienceByDate[formattedDate][audience] += spend;
      });
      
      // Update main visualizations
      updateAudienceChart();
      
      // Update summary stats
      updateAudienceSummary();
    }
    
    // Update the audience summary cards
    function updateAudienceSummary() {
      const summaryContainer = document.getElementById('audience-summary-container');
      if (!summaryContainer) return;
      
      summaryContainer.innerHTML = '';
      
      // Crear tarjetas para cada categoría principal
      const macroCategories = {
        'Business · Owner & Growth': { 
          class: 'business-segments', 
          icon: 'B' 
        },
        'Consumer · Financial Goals': { 
          class: 'consumer-financial', 
          icon: 'F' 
        },
        'Consumer · Shopping & Products': { 
          class: 'total-spend', 
          icon: 'S' 
        },
        'Consumer · Lifestyle & Interests': { 
          class: 'demographic-segments', 
          icon: 'L' 
        },
        'Consumer · Banking Preferences': { 
          class: 'demographic-segments', 
          icon: 'P' 
        },
        'Workforce & Employment': { 
          class: 'business-segments', 
          icon: 'W' 
        }
      };
      
      // Ordenar por gasto total (mayor a menor)
      const sortedCategories = Object.entries(audienceCategories)
        .sort((a, b) => b[1] - a[1]);
      
      // Crear tarjetas para cada categoría
      sortedCategories.forEach(([category, spend]) => {
        const cardClass = macroCategories[category]?.class || 'demographic-segments';
        const cardIcon = macroCategories[category]?.icon || '?';
        
        const formatted = formatCurrency(spend);
        
        const cardHTML = `
          <div class="card ${cardClass}">
            <div class="card-header">
              <h4 class="card-title">${category}</h4>
              <div class="card-icon">${cardIcon}</div>
            </div>
            <div class="metric-value">
              ${formatted.main}<span class="metric-decimal">${formatted.decimal}</span>
            </div>
            <div class="metric-context">
              ${(spend / totalAudienceReferences * 100).toFixed(2)}% del gasto total
            </div>
          </div>
        `;
        
        summaryContainer.innerHTML += cardHTML;
      });
    }
    
    // Create or update the audience chart
    function updateAudienceChart() {
      // Get year filter value
      const yearOverallFilter = document.getElementById('yearOverallFilter');
      const selectedYear = yearOverallFilter ? yearOverallFilter.value : 'all';
      
      // Get dates and audience categories
      let dates = Object.keys(audienceByDate).sort();
      const audienceCategoryNames = Object.keys(audienceCategories).sort();
      
      // Filter data by year if needed
      if (selectedYear !== 'all') {
        dates = dates.filter(date => date.startsWith(selectedYear));
      }
      
      // Skip if no data
      if (dates.length === 0 || audienceCategoryNames.length === 0) {
        console.log("No data available for audience chart");
        return;
      }
      
      console.log("Updating audience chart with dates:", dates.length, "categories:", audienceCategoryNames.length);
      
      // Prepare series data for ApexCharts
      const series = audienceCategoryNames.map((category, index) => {
        return {
          name: category,
          data: dates.map(date => audienceByDate[date][category] || 0)
        };
      });
      
      // Format x-axis dates
      const formattedDates = dates.map(date => moment(date).format('MMM YYYY'));
      
      // Destroy existing chart if it exists
      if (audienceChart) {
        audienceChart.destroy();
      }
      
      // Create chart container if it doesn't exist
      const chartContainer = document.getElementById('audienceChart');
      if (!chartContainer) {
        console.error("Chart container 'audienceChart' not found");
        return;
      }
      
      try {
        // ApexCharts options
        const options = {
          series: series,
          chart: {
            height: 350,
        type: 'line',
            zoom: {
              enabled: false
            },
            toolbar: {
              show: false
            },
            fontFamily: 'Segoe UI, Arial, sans-serif',
            background: '#fff',
            animations: {
              enabled: true,
              easing: 'easeinout',
              speed: 800
            },
            offsetY: 50,
            parentHeightOffset: 0
          },
            title: {
            text: '',
            align: 'center',
            style: {
              fontSize: '16px',
              fontWeight: 'bold',
              color: '#333'
            },
            margin: 40,
            offsetY: 20
          },
          colors: colorPalette,
          dataLabels: {
            enabled: false
          },
          stroke: {
            curve: 'smooth',
            width: 2.5
          },
          grid: {
            borderColor: '#e7e7e7',
            row: {
              colors: ['#f8f8f8', 'transparent'],
              opacity: 0.1
              },
              padding: {
              right: 10,
              left: 10
            }
          },
          markers: {
            size: 5,
            hover: {
              size: 7
            }
          },
          xaxis: {
            categories: formattedDates,
            title: {
              text: 'Month',
              style: {
                fontSize: '11px',
                fontWeight: 'bold',
                color: '#555'
              }
            },
              labels: {
              style: {
                fontSize: '10px',
                colors: '#555'
              }
            }
          },
          yaxis: {
            title: {
              text: 'Spend',
              style: {
                fontSize: '11px',
                fontWeight: 'bold',
                color: '#555'
              }
            },
            labels: {
              formatter: function(val) {
                return formatLargeNumber(val);
              },
              style: {
                fontSize: '10px',
                colors: '#555'
              },
              offsetX: -10
            }
          },
          legend: {
            position: 'right',
            fontSize: '11px',
            fontWeight: 500,
            markers: {
              width: 8,
              height: 8,
              radius: 6
            },
            itemMargin: {
              horizontal: 10,
              vertical: 5
            },
            verticalAlign: 'middle',
            height: 300,
            offsetY: 0,
            offsetX: 0
          },
            tooltip: {
            enabled: true,
            shared: true,
            intersect: false,
            followCursor: true,
            fillSeriesColor: false,
            onDatasetHover: {
              highlightDataSeries: true
            },
            custom: function({ series, seriesIndex, dataPointIndex, w }) {
              const date = formattedDates[dataPointIndex];
              let tooltipContent = `<div class="custom-tooltip">
                <div class="tooltip-title">${date}</div>`;
              
              // Add all category values for this date point
              let totalForMonth = 0;
              let categoryValues = [];
              
              audienceCategoryNames.forEach((category, idx) => {
                const value = series[idx][dataPointIndex];
                totalForMonth += value;
                categoryValues.push({
                  category: category,
                  value: value,
                  color: colorPalette[idx % colorPalette.length]
                });
              });
              
              // Sort categories by value (highest to lowest)
              categoryValues.sort((a, b) => b.value - a.value);
              
              // Calculate percentages and add each series to tooltip
              categoryValues.forEach(item => {
                const percentage = (item.value / totalForMonth * 100).toFixed(2);
                
                tooltipContent += `
                <div class="tooltip-row">
                  <span class="color-indicator" style="background-color: ${item.color}"></span>
                  <span class="category-name">${item.category}: </span>
                  <span class="tooltip-value">${formatLargeNumber(item.value, true)}</span>
                  <span class="tooltip-percentage">(${percentage}%)</span>
                </div>`;
              });
              
              tooltipContent += `</div>`;
              return tooltipContent;
            },
            marker: {
              show: true
            },
            theme: 'light'
          }
        };
        
        // Create chart
        audienceChart = new ApexCharts(document.getElementById('audienceChart'), options);
        audienceChart.render();
        console.log("Audience chart rendered successfully");
      } catch (error) {
        console.error("Error rendering audience chart:", error);
      }
    }
    
    // Create a chart showing the distribution of ad spend by audience category
    function updateCategoryDistributionChart() {
      // Get year filter value
      const yearFilter = document.getElementById('yearFilter').value;
      
      // Filter data based on year selection
      let filteredData = [...allData];
      if (yearFilter !== 'all') {
        filteredData = filteredData.filter(row => {
          return row["Date"].startsWith(yearFilter);
        });
      }
      
      // Process filtered data for ranking chart
      const categorySpend = {};
      let totalSpend = 0;
      
      filteredData.forEach(row => {
        const spend = parseFloat(row["Spend_USD"]) || 0;
        const audience = row["audience_macro"];
        
        // Track audience categories
        if (!categorySpend[audience]) {
          categorySpend[audience] = 0;
        }
        categorySpend[audience] += spend;
        totalSpend += spend;
      });
      
      // Skip if no data
      if (Object.keys(categorySpend).length === 0) {
        console.log("No data available for category distribution chart");
        return;
      }
      
      console.log("Updating distribution chart with categories:", Object.keys(categorySpend).length);
      
      // Sort categories by spend (highest to lowest)
      const sortedCategories = Object.entries(categorySpend)
        .sort((a, b) => b[1] - a[1]);
      
      const labels = sortedCategories.map(item => item[0]);
      const data = sortedCategories.map(item => item[1]);
      
      // Destroy existing charts if they exist
      if (categoryChart) {
        categoryChart.destroy();
      }
      
      if (donutChart) {
        donutChart.destroy();
      }
      
      // Create chart container if it doesn't exist
      const chartContainer = document.getElementById('categoryDistributionChart');
      if (!chartContainer) {
        console.error("Chart container 'categoryDistributionChart' not found");
        return;
      }
      
      const donutContainer = document.getElementById('categoryDonutChart');
      if (!donutContainer) {
        console.error("Chart container 'categoryDonutChart' not found");
        return;
      }
      
      try {
        // Create the ApexCharts bar chart
        const barOptions = {
          series: [{
            name: 'Ad Spend by Macro Category',
            data: data
          }],
          chart: {
            type: 'bar',
            height: 380,
            width: '100%',
            toolbar: {
              show: false
            },
            fontFamily: 'Segoe UI, Arial, sans-serif',
            background: '#fff',
            offsetX: -10
          },
          colors: labels.map((_, index) => colorPalette[index % colorPalette.length]),
          plotOptions: {
            bar: {
              horizontal: true,
              distributed: true,
              barHeight: '70%',
              dataLabels: {
                position: 'right',
                offsetX: 5
              }
            }
          },
          dataLabels: {
            enabled: true,
            formatter: function(val) {
              return formatLargeNumber(val);
            },
            textAnchor: 'start',
            style: {
              fontSize: '11px',
              colors: ['#333'],
              fontWeight: '600'
            },
            background: {
              enabled: false
            }
          },
          stroke: {
            width: 0
          },
              title: {
            text: yearFilter === 'all' ? 'Category Distribution' : `Category Distribution - ${yearFilter}`,
            align: 'center',
            style: {
              fontSize: '16px',
              fontWeight: 'bold',
              color: '#333'
            },
            margin: 15
          },
          xaxis: {
            categories: labels,
            labels: {
              style: {
                fontSize: '10px',
                colors: '#555'
              },
              formatter: function(value) {
                return formatLargeNumber(value);
              }
            }
          },
          yaxis: {
            labels: {
              style: {
                fontSize: '11px',
                colors: '#555'
              },
              formatter: undefined,
              minWidth: 200,
              maxWidth: 300,
              trim: false,
              offsetX: 0
            }
          },
          grid: {
            padding: {
              left: 110,
              right: 20
            }
          },
          tooltip: {
            enabled: true,
            shared: false,
            followCursor: true,
            custom: function({ series, seriesIndex, dataPointIndex, w }) {
              const categoryName = labels[dataPointIndex];
              const value = series[0][dataPointIndex];
              const percentage = (value / totalSpend * 100).toFixed(2);
              
              return `<div class="custom-tooltip">
                <div class="tooltip-title">${categoryName}</div>
                <div class="tooltip-value">${formatLargeNumber(value, true)}</div>
                <div class="tooltip-percentage">${percentage}% of total spend</div>
              </div>`;
            },
            theme: 'light'
          },
          legend: {
            show: false
          }
        };
        
        // Crear el donut chart
        const donutOptions = {
          series: data,
          chart: {
            type: 'donut',
            height: 380,
            fontFamily: 'Segoe UI, Arial, sans-serif',
            background: '#fff',
            offsetY: -10
          },
          labels: labels,
          colors: labels.map((_, index) => colorPalette[index % colorPalette.length]),
              title: {
            text: yearFilter === 'all' ? 'Total Spend Proportion' : `Total Spend Proportion - ${yearFilter}`,
            align: 'center',
            style: {
              fontSize: '16px',
              fontWeight: 'bold',
              color: '#333'
            },
            margin: 15
          },
          plotOptions: {
            pie: {
              donut: {
                size: '75%',
                labels: {
                  show: true,
                  total: {
                    show: true,
                    showAlways: true,
                    label: 'Total',
                    fontSize: '14px',
                    fontWeight: 600,
                    color: '#555',
                    formatter: function (w) {
                      return formatLargeNumber(w.globals.seriesTotals.reduce((a, b) => a + b, 0));
                    }
                  },
                  value: {
                    fontSize: '22px',
                    fontWeight: 700,
                    offsetY: 5,
                    formatter: function (val) {
                      return formatLargeNumber(val, true);
                    }
                  }
                }
              }
            }
          },
          dataLabels: {
            enabled: false
          },
          legend: {
            show: false
          },
          tooltip: {
            enabled: true,
            y: {
              formatter: function(value, { seriesIndex, dataPointIndex, w }) {
                const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                const percentage = ((value / total) * 100).toFixed(2);
                return `${formatLargeNumber(value, true)} (${percentage}%)`;
              }
            },
            custom: function({ series, seriesIndex, dataPointIndex, w }) {
              const value = series[seriesIndex];
              const label = w.globals.labels[seriesIndex];
              const total = series.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(2);
              
              return `<div class="custom-tooltip">
                <div class="tooltip-title">${label}</div>
                <div class="tooltip-value">${formatLargeNumber(value, true)}</div>
                <div class="tooltip-percentage">${percentage}% of total spend</div>
              </div>`;
            }
          },
          responsive: [{
            breakpoint: 992,
            options: {
              chart: {
                height: 350
              },
              legend: {
                position: 'bottom',
                fontSize: '10px'
              }
            }
          }]
        };
        
        categoryChart = new ApexCharts(document.getElementById('categoryDistributionChart'), barOptions);
        categoryChart.render();
        
        donutChart = new ApexCharts(document.getElementById('categoryDonutChart'), donutOptions);
        donutChart.render();
        
        console.log("Charts rendered successfully");
      } catch (error) {
        console.error("Error rendering charts:", error);
      }
    }
    
    // Load CSV data on page load
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM loaded, initializing application...");
      loadCSVData();
      
      // Añadir listener para el botón de carga manual
      document.getElementById('load-csv-button').addEventListener('click', handleManualUpload);
      
      // Añadir opción para cargar datos de ejemplo predefinidos
      const manualUploadDiv = document.getElementById('manual-upload');
      
      const sampleButton = document.createElement('button');
      sampleButton.className = 'btn btn-secondary mt-3';
      sampleButton.textContent = 'Cargar datos predefinidos';
      sampleButton.onclick = loadSampleData;
      
      manualUploadDiv.appendChild(document.createElement('br'));
      manualUploadDiv.appendChild(sampleButton);
    });
  </script>
</body>
</html>